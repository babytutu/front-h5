import{x as G,c as w,B as E,m as N,t as Y,d as H,r as v,C as R,a as z,w as L,D as I,f as K,E as p,h as d,n as A,G as V,H as q,q as U,j as J,J as O,K as X,L as Q,A as F,u as B,y,s as W,z as Z,F as ee,M as te}from"./main-badb91ba.js";import{L as M,C as ae}from"./index-4b8ceaad.js";import{u as ne}from"./index-f6e07e2f.js";import{u as se}from"./use-expose-dda53ed5.js";import{$ as oe,a as le}from"./axios-295af5fe.js";const ie=Symbol(),re=()=>G(ie,null),[ue,S,ce]=w("list"),de={error:Boolean,offset:E(300),loading:Boolean,disabled:Boolean,finished:Boolean,scroller:Object,errorText:String,direction:N("down"),loadingText:String,finishedText:String,immediateCheck:Y};var fe=H({name:ue,props:de,emits:["load","update:error","update:loading"],setup(e,{emit:f,slots:n}){const s=v(e.loading),u=v(),c=v(),i=re(),a=R(u),h=z(()=>e.scroller||a.value),T=()=>{A(()=>{if(s.value||e.finished||e.disabled||e.error||(i==null?void 0:i.value)===!1)return;const{direction:o}=e,x=+e.offset,l=V(h);if(!l.height||q(u))return;let k=!1;const $=V(c);o==="up"?k=l.top-$.top<=x:k=$.bottom-l.bottom<=x,k&&(s.value=!0,f("update:loading",!0),f("load"))})},_=()=>{if(e.finished){const o=n.finished?n.finished():e.finishedText;if(o)return d("div",{class:S("finished-text")},[o])}},b=()=>{f("update:error",!1),T()},g=()=>{if(e.error){const o=n.error?n.error():e.errorText;if(o)return d("div",{role:"button",class:S("error-text"),tabindex:0,onClick:b},[o])}},m=()=>{if(s.value&&!e.finished&&!e.disabled)return d("div",{class:S("loading")},[n.loading?n.loading():d(M,{class:S("loading-icon")},{default:()=>[e.loadingText||ce("loading")]})])};return L(()=>[e.loading,e.finished,e.error],T),i&&L(i,o=>{o&&T()}),I(()=>{s.value=e.loading}),K(()=>{e.immediateCheck&&T()}),se({check:T}),p("scroll",T,{target:h,passive:!0}),()=>{var o;const x=(o=n.default)==null?void 0:o.call(n),l=d("div",{ref:c,class:S("placeholder")},null);return d("div",{ref:u,role:"feed",class:S(),"aria-busy":s.value},[e.direction==="down"?x:l,m(),_(),g(),e.direction==="up"?x:l])}}});const he=U(fe),[ge,P,me]=w("pull-refresh"),j=50,ve=["pulling","loosing","success"],Te={disabled:Boolean,modelValue:Boolean,headHeight:E(j),successText:String,pullingText:String,loosingText:String,loadingText:String,pullDistance:J,successDuration:E(500),animationDuration:E(300)};var xe=H({name:ge,props:Te,emits:["change","refresh","update:modelValue"],setup(e,{emit:f,slots:n}){let s;const u=v(),c=v(),i=R(u),a=O({status:"normal",distance:0,duration:0}),h=ne(),T=()=>{if(e.headHeight!==j)return{height:`${e.headHeight}px`}},_=()=>a.status!=="loading"&&a.status!=="success"&&!e.disabled,b=t=>{const r=+(e.pullDistance||e.headHeight);return t>r&&(t<r*2?t=r+(t-r)/2:t=r*1.5+(t-r*2)/4),Math.round(t)},g=(t,r)=>{const D=+(e.pullDistance||e.headHeight);a.distance=t,r?a.status="loading":t===0?a.status="normal":t<D?a.status="pulling":a.status="loosing",f("change",{status:a.status,distance:t})},m=()=>{const{status:t}=a;return t==="normal"?"":e[`${t}Text`]||me(t)},o=()=>{const{status:t,distance:r}=a;if(n[t])return n[t]({distance:r});const D=[];return ve.includes(t)&&D.push(d("div",{class:P("text")},[m()])),t==="loading"&&D.push(d(M,{class:P("loading")},{default:m})),D},x=()=>{a.status="success",setTimeout(()=>{g(0)},+e.successDuration)},l=t=>{s=X(i.value)===0,s&&(a.duration=0,h.start(t))},k=t=>{_()&&l(t)},$=t=>{if(_()){s||l(t);const{deltaY:r}=h;h.move(t),s&&r.value>=0&&h.isVertical()&&(Q(t),g(b(r.value)))}},C=()=>{s&&h.deltaY.value&&_()&&(a.duration=+e.animationDuration,a.status==="loosing"?(g(+e.headHeight,!0),f("update:modelValue",!0),A(()=>f("refresh"))):g(0))};return L(()=>e.modelValue,t=>{a.duration=+e.animationDuration,t?g(+e.headHeight,!0):n.success||e.successText?x():g(0,!1)}),p("touchmove",$,{target:c}),()=>{var t;const r={transitionDuration:`${a.duration}ms`,transform:a.distance?`translate3d(0,${a.distance}px, 0)`:""};return d("div",{ref:u,class:P()},[d("div",{ref:c,class:P("track"),style:r,onTouchstartPassive:k,onTouchend:C,onTouchcancel:C},[d("div",{class:P("head"),style:T()},[o()]),(t=n.default)==null?void 0:t.call(n)])])}}});const _e=U(xe);const Se=H({__name:"T-list",emits:["getData"],setup(e,{expose:f,emit:n}){const s=n,u=v(!1),c=v(!1),i=v(!1),a=v([]),h=v(1);function T(g,m){a.value=a.value.concat(g),c.value=m,i.value=!1,u.value=!1,m||h.value++}function _(){u.value=!0,i.value&&(a.value=[]),s("getData",h.value)}function b(){i.value=!0,a.value=[],h.value=1,_()}return f({renderList:T}),(g,m)=>{const o=he,x=_e;return y(),F(x,{modelValue:i.value,"onUpdate:modelValue":m[1]||(m[1]=l=>i.value=l),onRefresh:b},{default:B(()=>[d(o,{loading:u.value,"onUpdate:loading":m[0]||(m[0]=l=>u.value=l),finished:c.value,"finished-text":"没有更多了",onLoad:_},{default:B(()=>[(y(!0),W(ee,null,Z(a.value,l=>te(g.$slots,"default",{key:l.id,data:l})),128))]),_:3},8,["loading","finished"])]),_:3},8,["modelValue"])}}}),be=10,He=H({__name:"listPage",setup(e){const f=v(null);function n(s){oe.get(le.fakerapi("books",20)).then(u=>{var c;(c=f.value)==null||c.renderList(u.data,s>be)})}return(s,u)=>{const c=ae;return y(),F(Se,{ref_key:"list",ref:f,onGetData:n},{default:B(i=>[d(c,{title:i.data.title,label:i.data.description},null,8,["title","label"])]),_:1},512)}}});export{He as default};
