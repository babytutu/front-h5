import{c as A,i as xe,N as P,X as Q,d as R,j as W,Y as L,Z as D,r as C,a as _,$ as ve,a0 as Ee,E as fe,h as b,L as he,B as N,t as we,m as Pe,a1 as Se,a2 as Ie,w as H,a3 as X,n as ne,a4 as B,p as ge,q as pe,f as $e,A as oe,u as Z,y as U,s as ae,F as le,z as Ve,v as Me,W as Ne,a5 as He}from"./main-ef9e9c0f.js";import{C as De}from"./index-dd991a4b.js";import{H as se,L as Be,b as Ae,C as Re}from"./index-b2f44d30.js";import{u as Fe,s as Le,c as Ue,P as Ye}from"./index-aa10a9ad.js";import{F as je}from"./index-b6330cc5.js";import{$ as ce,a as ie}from"./axios-3c3c3b9a.js";import{u as te}from"./use-expose-f3fd770b.js";const[Ke,x,ue]=A("picker"),be=e=>e.find(o=>!o.disabled)||e[0];function qe(e,o){const n=e[0];if(n){if(Array.isArray(n))return"multiple";if(o.children in n)return"cascade"}return"default"}function Y(e,o){o=Q(o,0,e.length);for(let n=o;n<e.length;n++)if(!e[n].disabled)return n;for(let n=o-1;n>=0;n--)if(!e[n].disabled)return n;return 0}const re=(e,o,n)=>o!==void 0&&!!e.find(c=>c[n.value]===o);function ee(e,o,n){const c=e.findIndex(h=>h[n.value]===o),l=Y(e,c);return e[l]}function ze(e,o,n){const c=[];let l={[o.children]:e},h=0;for(;l&&l[o.children];){const f=l[o.children],g=n.value[h];if(l=xe(g)?ee(f,g,o):void 0,!l&&f.length){const d=be(f)[o.value];l=ee(f,d,o)}h++,c.push(f)}return c}function Ge(e){const{transform:o}=window.getComputedStyle(e),n=o.slice(7,o.length-1).split(", ")[5];return Number(n)}function We(e){return P({text:"text",value:"value",children:"children"},e)}const me=200,de=300,Xe=15,[ye,J]=A("picker-column"),Oe=Symbol(ye);var Ze=R({name:ye,props:{value:W,fields:L(Object),options:D(),readonly:Boolean,allowHtml:Boolean,optionHeight:L(Number),swipeDuration:L(W),visibleOptionNum:L(W)},emits:["change","clickOption","scrollInto"],setup(e,{emit:o,slots:n}){let c,l,h,f,g;const d=C(),s=C(),r=C(0),i=C(0),v=Fe(),p=()=>e.options.length,T=()=>e.optionHeight*(+e.visibleOptionNum-1)/2,O=m=>{let t=Y(e.options,m);const a=-t*e.optionHeight,u=()=>{t>p()-1&&(t=Y(e.options,m));const E=e.options[t][e.fields.value];E!==e.value&&o("change",E)};c&&a!==r.value?g=u:u(),r.value=a},k=()=>e.readonly||!e.options.length,y=m=>{c||k()||(g=null,i.value=me,O(m),o("clickOption",e.options[m]))},S=m=>Q(Math.round(-m/e.optionHeight),0,p()-1),F=_(()=>S(r.value)),q=(m,t)=>{const a=Math.abs(m/t);m=r.value+a/.003*(m<0?-1:1);const u=S(m);i.value=+e.swipeDuration,O(u)},$=()=>{c=!1,i.value=0,g&&(g(),g=null)},z=m=>{if(!k()){if(v.start(m),c){const t=Ge(s.value);r.value=Math.min(0,t-T())}i.value=0,l=r.value,h=Date.now(),f=l,g=null}},G=m=>{if(k())return;v.move(m),v.isVertical()&&(c=!0,he(m,!0));const t=Q(l+v.deltaY.value,-(p()*e.optionHeight),e.optionHeight),a=S(t);a!==F.value&&o("scrollInto",e.options[a]),r.value=t;const u=Date.now();u-h>de&&(h=u,f=t)},V=()=>{if(k())return;const m=r.value-f,t=Date.now()-h;if(t<de&&Math.abs(m)>Xe){q(m,t);return}const u=S(r.value);i.value=me,O(u),setTimeout(()=>{c=!1},0)},I=()=>{const m={height:`${e.optionHeight}px`};return e.options.map((t,a)=>{const u=t[e.fields.text],{disabled:E}=t,M=t[e.fields.value],ke={role:"button",style:m,tabindex:E?-1:0,class:[J("item",{disabled:E,selected:M===e.value}),t.className],onClick:()=>y(a)},_e={class:"van-ellipsis",[e.allowHtml?"innerHTML":"textContent"]:u};return b("li",ke,[n.option?n.option(t,a):b("div",_e,null)])})};return ve(Oe),te({stopMomentum:$}),Ee(()=>{const m=c?Math.floor(-r.value/e.optionHeight):e.options.findIndex(u=>u[e.fields.value]===e.value),t=Y(e.options,m),a=-t*e.optionHeight;c&&t<m&&$(),r.value=a}),fe("touchmove",G,{target:d}),()=>b("div",{ref:d,class:J(),onTouchstartPassive:z,onTouchend:V,onTouchcancel:V},[b("ul",{ref:s,style:{transform:`translate3d(0, ${r.value+T()}px, 0)`,transitionDuration:`${i.value}ms`,transitionProperty:i.value?"all":"none"},class:J("wrapper"),onTransitionend:$},[I()])])}});const[Je]=A("picker-toolbar"),K={title:String,cancelButtonText:String,confirmButtonText:String},Qe=["cancel","confirm","title","toolbar"],et=Object.keys(K);var tt=R({name:Je,props:K,emits:["confirm","cancel"],setup(e,{emit:o,slots:n}){const c=()=>{if(n.title)return n.title();if(e.title)return b("div",{class:[x("title"),"van-ellipsis"]},[e.title])},l=()=>o("cancel"),h=()=>o("confirm"),f=()=>{const d=e.cancelButtonText||ue("cancel");return b("button",{type:"button",class:[x("cancel"),se],onClick:l},[n.cancel?n.cancel():d])},g=()=>{const d=e.confirmButtonText||ue("confirm");return b("button",{type:"button",class:[x("confirm"),se],onClick:h},[n.confirm?n.confirm():d])};return()=>b("div",{class:x("toolbar")},[n.toolbar?n.toolbar():[f(),c(),g()]])}});const[nt,Ct]=A("picker-group"),ot=Symbol(nt);P({tabs:D(),activeTab:N(0),nextStepText:String},K);const Ce=P({loading:Boolean,readonly:Boolean,allowHtml:Boolean,optionHeight:N(44),showToolbar:we,swipeDuration:N(1e3),visibleOptionNum:N(6)},K),at=P({},Ce,{columns:D(),modelValue:D(),toolbarPosition:Pe("top"),columnsFieldNames:Object});var lt=R({name:Ke,props:at,emits:["confirm","cancel","change","scrollInto","clickOption","update:modelValue"],setup(e,{emit:o,slots:n}){const c=C(),l=C(e.modelValue.slice(0)),{parent:h}=ve(ot),{children:f,linkChildren:g}=Se(Oe);g();const d=_(()=>We(e.columnsFieldNames)),s=_(()=>Ie(e.optionHeight)),r=_(()=>qe(e.columns,d.value)),i=_(()=>{const{columns:t}=e;switch(r.value){case"multiple":return t;case"cascade":return ze(t,d.value,l);default:return[t]}}),v=_(()=>i.value.some(t=>t.length)),p=_(()=>i.value.map((t,a)=>ee(t,l.value[a],d.value))),T=_(()=>i.value.map((t,a)=>t.findIndex(u=>u[d.value.value]===l.value[a]))),O=(t,a)=>{if(l.value[t]!==a){const u=l.value.slice(0);u[t]=a,l.value=u}},k=()=>({selectedValues:l.value.slice(0),selectedOptions:p.value,selectedIndexes:T.value}),y=(t,a)=>{O(a,t),r.value==="cascade"&&l.value.forEach((u,E)=>{const M=i.value[E];re(M,u,d.value)||O(E,M.length?M[0][d.value.value]:void 0)}),ne(()=>{o("change",P({columnIndex:a},k()))})},S=(t,a)=>{const u={columnIndex:a,currentOption:t};o("clickOption",P(k(),u)),o("scrollInto",u)},F=()=>{f.forEach(a=>a.stopMomentum());const t=k();return ne(()=>{o("confirm",t)}),t},q=()=>o("cancel",k()),$=()=>i.value.map((t,a)=>b(Ze,{value:l.value[a],fields:d.value,options:t,readonly:e.readonly,allowHtml:e.allowHtml,optionHeight:s.value,swipeDuration:e.swipeDuration,visibleOptionNum:e.visibleOptionNum,onChange:u=>y(u,a),onClickOption:u=>S(u,a),onScrollInto:u=>{o("scrollInto",{currentOption:u,columnIndex:a})}},{option:n.option})),z=t=>{if(v.value){const a={height:`${s.value}px`},u={backgroundSize:`100% ${(t-s.value)/2}px`};return[b("div",{class:x("mask"),style:u},null),b("div",{class:[Ae,x("frame")],style:a},null)]}},G=()=>{const t=s.value*+e.visibleOptionNum,a={height:`${t}px`};return b("div",{ref:c,class:x("columns"),style:a},[$(),z(t)])},V=()=>{if(e.showToolbar&&!h)return b(tt,ge(B(e,et),{onConfirm:F,onCancel:q}),B(n,Qe))};H(i,t=>{t.forEach((a,u)=>{a.length&&!re(a,l.value[u],d.value)&&O(u,be(a)[d.value.value])})},{immediate:!0});let I;return H(()=>e.modelValue,t=>{!X(t,l.value)&&!X(t,I)&&(l.value=t.slice(0),I=t.slice(0))},{deep:!0}),H(l,t=>{X(t,e.modelValue)||(I=t.slice(0),o("update:modelValue",I))},{immediate:!0}),fe("touchmove",he,{target:c}),te({confirm:F,getSelectedOptions:()=>p.value}),()=>{var t,a;return b("div",{class:x()},[e.toolbarPosition==="top"?V():null,e.loading?b(Be,{class:x("loading")},null):null,(t=n["columns-top"])==null?void 0:t.call(n),G(),(a=n["columns-bottom"])==null?void 0:a.call(n),e.toolbarPosition==="bottom"?V():null])}}});const j="000000",st=["title","cancel","confirm","toolbar","columns-top","columns-bottom"],Te=["title","loading","readonly","optionHeight","swipeDuration","visibleOptionNum","cancelButtonText","confirmButtonText"],w=(e="",o=j,n=void 0)=>({text:e,value:o,children:n});function ct({areaList:e,columnsNum:o,columnsPlaceholder:n}){const{city_list:c={},county_list:l={},province_list:h={}}=e,f=+o>1,g=+o>2,d=()=>{if(f)return n.length?[w(n[0],j,g?[]:void 0)]:[]},s=new Map;Object.keys(h).forEach(v=>{s.set(v.slice(0,2),w(h[v],v,d()))});const r=new Map;if(f){const v=()=>{if(g)return n.length?[w(n[1])]:[]};Object.keys(c).forEach(p=>{const T=w(c[p],p,v());r.set(p.slice(0,4),T);const O=s.get(p.slice(0,2));O&&O.children.push(T)})}g&&Object.keys(l).forEach(v=>{const p=r.get(v.slice(0,4));p&&p.children.push(w(l[v],v))});const i=Array.from(s.values());if(n.length){const v=g?[w(n[2])]:void 0,p=f?[w(n[1],j,v)]:void 0;i.unshift(w(n[0],j,p))}return i}const it=pe(lt),[ut,rt]=A("area"),mt=P({},B(Ce,Te),{modelValue:String,columnsNum:N(3),columnsPlaceholder:D(),areaList:{type:Object,default:()=>({})}});var dt=R({name:ut,props:mt,emits:["change","confirm","cancel","update:modelValue"],setup(e,{emit:o,slots:n}){const c=C([]),l=C(),h=_(()=>ct(e)),f=(...s)=>o("change",...s),g=(...s)=>o("cancel",...s),d=(...s)=>o("confirm",...s);return H(c,s=>{const r=s.length?s[s.length-1]:"";r&&r!==e.modelValue&&o("update:modelValue",r)},{deep:!0}),H(()=>e.modelValue,s=>{if(s){const r=c.value.length?c.value[c.value.length-1]:"";s!==r&&(c.value=[`${s.slice(0,2)}0000`,`${s.slice(0,4)}00`,s].slice(0,+e.columnsNum))}else c.value=[]},{immediate:!0}),te({confirm:()=>{var s;return(s=l.value)==null?void 0:s.confirm()},getSelectedOptions:()=>{var s;return((s=l.value)==null?void 0:s.getSelectedOptions())||[]}}),()=>b(it,ge({ref:l,modelValue:c.value,"onUpdate:modelValue":s=>c.value=s,class:rt(),columns:h.value,onChange:f,onCancel:g,onConfirm:d},B(e,Te)),B(n,st))}});const vt=pe(dt);const Tt=R({__name:"cityPage",setup(e){const o=C(!1),n=C({}),c=C("杭州市"),l=["周一","周二","周三","周四","周五","周六","周日"],h=C("330100"),f=C({province_list:{},city_list:{}}),g=r=>{o.value=!1;const[{text:i,value:v},{text:p="",value:T=""}={}]=r.selectedOptions;c.value=p||i,d(T||v)},d=r=>{Le({duration:0,message:"加载中...",forbidClick:!0}),ce.get(ie.api+`/weather/${r}`).then(i=>{n.value=i.data,Ue()})},s=()=>{ce.get(ie.api+"/district").then(r=>{r.data.forEach(i=>{f.value.province_list[i.adcode]=i.name,i.districts.forEach(v=>{f.value.city_list[v.adcode]=v.name})})})};return $e(()=>{s(),d(h.value)}),(r,i)=>{const v=je,p=vt,T=Ye,O=Re,k=De;return U(),oe(k,{title:"高德API"},{default:Z(()=>[b(v,{modelValue:c.value,"onUpdate:modelValue":i[0]||(i[0]=y=>c.value=y),"is-link":"",readonly:"",label:"城市",placeholder:"请选择",onClick:i[1]||(i[1]=y=>o.value=!0)},null,8,["modelValue"]),b(T,{show:o.value,"onUpdate:show":i[3]||(i[3]=y=>o.value=y),position:"bottom"},{default:Z(()=>[b(p,{modelValue:h.value,"onUpdate:modelValue":i[2]||(i[2]=y=>h.value=y),title:"标题","area-list":f.value,"columns-num":2,onConfirm:g},null,8,["modelValue","area-list"])]),_:1},8,["show"]),n.value.city?(U(),ae(le,{key:0},[b(O,{title:n.value.province+"-"+n.value.city,value:n.value.reporttime},null,8,["title","value"]),(U(!0),ae(le,null,Ve(n.value.casts,y=>(U(),oe(O,{key:y.date,title:y.date,value:l[y.week?y.week-1:0]},{label:Z(()=>[Ne(He(y.dayweather+"~"+y.nightweather+" ("+y.nighttemp+"℃~"+y.daytemp+"℃)"),1)]),_:2},1032,["title","value"]))),128))],64)):Me("",!0)]),_:1})}}});export{Tt as default};
