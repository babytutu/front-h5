import{j,r as m,h as H,G as I,D as J,V as K,C as M,S as W,W as X,X as Y,Y as Z,y as f,x as a,q as o,F as C,N as g,z as A,l as U,R as z,$ as N,K as F,T as G,v as i,J as _,U as s,u as w,H as R,Z as D,_ as Q,a0 as ee}from"./api-b054bace.js";import"./tool-03c2ae31.js";const te=$=>{function b(r,c,h){if(r.createTextRange){const d=r.createTextRange();d.collapse(!0),d.moveStart("character",c),d.moveEnd("character",h-c),d.select()}else r.setSelectionRange(c,h),r.focus()}const n=$.toString();let l=document.querySelector("#copy-input");l||(l=document.createElement("input"),l.id="copy-input",l.readOnly="readOnly",l.style.position="absolute",l.style.left="-1000px",l.style.zIndex="-1000",document.body.appendChild(l)),l.value=n,b(l,0,n.length);let u=!1;return document.execCommand("copy")&&(document.execCommand("copy"),u=!0),l.blur(),u},ae={key:0},oe={key:1},le={key:2},ne=["src"],se=j({__name:"yLibrary",setup($){const b=m([]),n=m(1),l=m("福尔摩斯"),u=m(0),r=H(()=>Math.ceil(u.value/20)),c=m(["epub"]),h=m([]),d=m(!1),B=m(""),E=()=>{n.value=1,T()},S=v=>{h.value=v.length?b.value.filter(t=>v.includes(t.extension)):b.value},T=async()=>{z({duration:0,message:"加载中...",forbidClick:!0});const v=await N.post(F.api,{url:"https://api.ylibrary.org/api/search/",data:{keyword:l.value,page:n.value,sensitive:!1},method:"post"}),{hits:t,data:y}=v;u.value=t,b.value=y,S(c.value),G()},O=async v=>{z({duration:0,message:"加载中...",forbidClick:!0});const t=await N.post(F.api,{url:"https://api.ylibrary.org/api/detail/",data:{id:v,source:"zlibrary"},method:"post"}),{ipfs_cid:y}=t;G(),y||D("暂无下载");const p=`https://ipfs-checker.1kbtool.com/${y}`;Q({title:"IPFS下载",confirmButtonText:"访问",cancelButtonText:"复制",message:p}).then(()=>{B.value=p,d.value=!0}).catch(()=>{const k=te(p);D({type:k?"success":"fail",message:`复制${k?"成功":"失败"}`})})};return(v,t)=>{const y=I,p=J,k=K,x=M,L=W,V=X,q=Y,P=Z;return i(),f(C,null,[a(k,{onSubmit:E},{default:o(()=>[a(p,{modelValue:l.value,"onUpdate:modelValue":t[0]||(t[0]=e=>l.value=e),name:"关键字",label:"关键字",placeholder:"请填写关键字",center:"",clearable:"",rules:[{required:!0,message:"请填写关键字"}]},{button:o(()=>[a(y,{size:"small",type:"primary","native-type":"submit"},{default:o(()=>[_("查询")]),_:1})]),_:1},8,["modelValue"])]),_:1}),u.value?(i(),f(C,{key:0},[a(x,null,{default:o(()=>[_("第 "+s(n.value)+" 页， 共 "+s(u.value)+" 条 / "+s(w(r))+" 页",1)]),_:1}),a(p,{name:"stepper",label:"页数"},{input:o(()=>[a(L,{modelValue:n.value,"onUpdate:modelValue":t[1]||(t[1]=e=>n.value=e),min:"1",max:w(r),onChange:T},null,8,["modelValue","max"])]),_:1}),a(p,{name:"checkboxGroup",label:"格式"},{input:o(()=>[a(q,{onChange:S,modelValue:c.value,"onUpdate:modelValue":t[2]||(t[2]=e=>c.value=e),direction:"horizontal"},{default:o(()=>[a(V,{name:"epub",shape:"square"},{default:o(()=>[_("epub")]),_:1}),a(V,{name:"pdf",shape:"square"},{default:o(()=>[_("pdf")]),_:1})]),_:1},8,["modelValue"])]),_:1})],64)):g("",!0),h.value.length?(i(!0),f(C,{key:1},A(h.value,e=>(i(),U(x,{onClick:ue=>O(e.id),title:e.title,label:e.publisher,key:e},{extra:o(()=>[_(s(e.year),1)]),label:o(()=>[e.publisher?(i(),f("p",ae,"出版社:"+s(e.publisher),1)):g("",!0),e.isbn?(i(),f("p",oe,"ISBN: "+s(e.isbn),1)):g("",!0),R("p",null,"格式: "+s(e.extension),1),e.author?(i(),f("p",le,"作者："+s(e.author),1)):g("",!0)]),_:2},1032,["onClick","title","label"]))),128)):(i(),U(x,{key:2,title:"暂无结果"})),u.value?(i(),f(C,{key:3},[a(x,null,{default:o(()=>[_("第 "+s(n.value)+" 页， 共 "+s(u.value)+" 条 / "+s(w(r))+" 页",1)]),_:1}),a(p,{name:"stepper",label:"页数"},{input:o(()=>[a(L,{modelValue:n.value,"onUpdate:modelValue":t[3]||(t[3]=e=>n.value=e),min:"1",max:w(r),onChange:T},null,8,["modelValue","max"])]),_:1}),a(p,{name:"checkboxGroup",label:"格式"},{input:o(()=>[a(q,{onChange:S,modelValue:c.value,"onUpdate:modelValue":t[4]||(t[4]=e=>c.value=e),direction:"horizontal"},{default:o(()=>[a(V,{name:"epub",shape:"square"},{default:o(()=>[_("epub")]),_:1}),a(V,{name:"pdf",shape:"square"},{default:o(()=>[_("pdf")]),_:1})]),_:1},8,["modelValue"])]),_:1})],64)):g("",!0),a(P,{show:d.value,"onUpdate:show":t[5]||(t[5]=e=>d.value=e),position:"bottom",closeable:"","close-icon":"close",style:{height:"100%"}},{default:o(()=>[R("iframe",{src:B.value,class:"iframe"},null,8,ne)]),_:1},8,["show"])],64)}}});const pe=ee(se,[["__scopeId","data-v-3becf203"]]);export{pe as default};
